{{extend './layout/layout.html'}}
{{block 'bread'}}
<ol class="breadcrumb">
    <li><a href="/admin">博客管理</a></li>
    <li class="active" data-now-value="blogSettings">修改密码</li>
</ol>
{{/block}}
{{block 'content'}}
<form action="" class="form-horizontal">
    <div class="form-group">
        <label class="col-xs-3 control-label">头像</label>
        <div class="col-xs-2 preview">
            <img src="{{user.avatar||'/public/admin/images/default.png'}}">
            <input type="file" id="upFile">
            <input type="hidden" id="avatar" name="avatar" value="{{user.avatar||'/public/admin/images/default.png'}}">
            <div class="cover">
                <i class="glyphicon glyphicon-upload"></i>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label for="name" class="col-xs-3 control-label">用户名</label>
        <div class="col-xs-5">
            <input id="name" name="name" type="text" class="form-control input-sm" value="{{user.name}}">
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-3 control-label">性别</label>
        <div class="col-xs-3">
            <label class="radio-inline">
                <input type="radio" name="gender" value="0" {{user.gender==0?'checked':''}}> 男
            </label>
            <label class="radio-inline">
                <input type="radio" name="gender" value="1" {{user.gender==1?'checked':''}}> 女
            </label>
        </div>
    </div>
    <div class="form-group">
        <label for="phone" class="col-xs-3 control-label">手机号码</label>
        <div class="col-xs-5">
            <input id="phone" name="phone" type="text" class="form-control input-sm" value="{{user.phone}}">
        </div>
    </div>
    <div class="form-group">
        <label for="company" class="col-xs-3 control-label">就职公司</label>
        <div class="col-xs-5">
            <input id="company" name="company" type="text" class="form-control input-sm" value="{{user.company}}">
        </div>
    </div>
    <div class="form-group">
        <label for="homepage" class="col-xs-3 control-label">个人主页</label>
        <div class="col-xs-5">
            <input id="homepage" name="homepage" type="text" class="form-control input-sm" value="{{user.homepage}}">
        </div>
    </div>
    <div class="form-group">
        <label for="alt" class="col-xs-3 control-label">个性签名</label>
        <div class="col-xs-5 ckeditor">
            <textarea id="alt" name="alt" rows="5" class="form-control input-sm">{{user.alt}}</textarea>
        </div>
    </div>
    <div class="form-group">
        <div class="col-xs-8">
            <a href="javascript:;" class="btn btn-success btn-sm pull-right">保 存</a>
            <a href="./repass.html" class="btn btn-link btn-sm pull-right">更改密码？</a>
        </div>
    </div>
</form>
{{/block}}
{{block 'script'}}
<script>
    $('#upFile').on('change', function () {
        var files = this.files;
        var formData = new FormData();
        formData.append('avatar', files[0]);
        var xhr = new XMLHttpRequest();
        xhr.open('post', '/admin/upload');
        xhr.send(formData);
        xhr.onload = function () {
            $('#avatar').val(xhr.responseText).siblings('img').attr('src', xhr.responseText);
        }
    });
    $('.btn-success').on('click',function () {
        $.ajax({
            type:'post',
            url:'/admin/settings',
            data:$('form').serialize(),
            dataType:'json',
            success:function (data) {
                if(data.success){
                    alert('个人设置成功');
                }else{
                    alert(data.msg||'个人设置失败');
                }
            }
        });
    });
</script>
{{/block}}